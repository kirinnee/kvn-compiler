'use strict';var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var GameSound=function(){function GameSound(soundtype,source,loop){_classCallCheck(this,GameSound);if(!enableSound){return}this.isPlaying=false;this.isPaused=false;this.soundType=soundtype;this.soundType.getSoundRegistered().push(this);this.sourceData=source;this.seek=-1;this.nIndex=window.soundCheckArray.length;window.soundCheckArray.push(false);var nI=this.nIdex;if(loop===null||typeof loop==='undefined'){loop=false}var ele=this;this.promise=null;this.sound=new Howl({src:[dir+'sound/'+source],html5:false,// Force to HTML5 so that the audio can stream in (best for large files).
onload:function onload(){soundCheckArray[nI]=true},onfade:function onfade(){ele.volume=ele.sound.volume();ele.isFading=false;ele.applyVolume()},onend:function onend(){if(ele.promise!==null&&typeof ele.promise==='function'){ele.promise()}}});this.sound.loop(loop);this.volume=1;this.isFading=false;this.registered=false;this.customloop=null}_createClass(GameSound,[{key:'register',value:function register(){this.registered=true}},{key:'setLoop',value:function setLoop(boolean){if(!enableSound){return}this.sanitizeInput('boolean',boolean,false,'boolean','setLoop');this.sound.loop(boolean)}},{key:'play',value:function play(promise){if(!enableSound){return}this.applyVolume();this.sanitizeInput('function',promise,function(){},'promise','play');if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{if(this.isPlaying&&!this.isPaused){this.stop()}if(this.isPaused&&typeof this.seek!=='undefined'&&this.seek!==-1){this.sound.seek(this.seek)}else{clearInterval(this.customloop)}this.isPlaying=true;this.isPaused=false;this.sound.play();this.promise=promise}}},{key:'playFromTo',value:function playFromTo(start,end,loop,promise){if(!enableSound){return}this.sanitizeInput('number',start,0,'start','playFromTo or playFromFor');this.sanitizeInput('number',end,null,'playFromTo or playFromFor');this.sanitizeInput('boolean',loop,false,'playFromTo or playFromFor');this.sanitizeInput('function',promise,function(){},'playFromTo or playFromFor');this.play();this.sound.seek(start);var ele=this;this.customloop=setInterval(function(){if(ele.sound.seek()>end){if(loop){ele.sound.seek(start)}else{clearInterval(ele.customloop);ele.stop();promise()}}},10)}},{key:'playFromFor',value:function playFromFor(start,duration,loop,promise){if(!enableSound){return}this.playFromTo(start,start+duration,loop,promise)}},{key:'pause',value:function pause(){if(!enableSound){return}if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{this.seek=this.sound.seek();this.sound.pause();this.isPaused=true}}},{key:'stop',value:function stop(){if(!enableSound){return}if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{clearInterval(this.customloop);this.isPlaying=false;this.isPaused=false;this.sound.stop();this.promise=null}}},{key:'mute',value:function mute(){if(!enableSound){return}if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{this.sound.mute()}}},{key:'changeVolume',value:function changeVolume(vol){if(!enableSound){return}if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{this.volume=vol;this.applyVolume()}}},{key:'applyVolume',value:function applyVolume(){if(!enableSound){return}if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{if(!this.isFading){this.sound.volume(this.volume*this.soundType.getVolume())}}}},{key:'fade',value:function fade(duration,from,to){if(!enableSound){return}this.sanitizeInput('number',duration,1000,'duration','fade');this.sanitizeInput('number',from,1,'from','fade');this.sanitizeInput('number',to,0,'to','fade');if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{clearInterval(this.customloop);this.sound.fade(from*this.soundType.getVolume(),to*this.soundType.getVolume(),duration);this.isFading=true}}},{key:'fadeIn',value:function fadeIn(duration){if(!enableSound){return}this.sanitizeInput('number',duration,1000,'duration','fadeIn');if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{clearInterval(this.customloop);this.sound.fade(0,1*this.soundType.getVolume(),duration);this.isFading=true}}},{key:'fadeOut',value:function fadeOut(duration){if(!enableSound){return}this.sanitizeInput('number',duration,1000,'duration','fadeOut');if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{clearInterval(this.customloop);this.sound.fade(1*this.soundType.getVolume(),0,duration);this.isFading=true}}},{key:'rate',value:function rate(_rate){if(!enableSound){return}this.sanitizeInput('number',_rate,1,'rate','rate');if(!soundRegistered||!this.registered){this.throwError('Incorrect Lifecycle Exception: playing sound that is not constructed under soundLoadPhase() method')}else{this.sound.rate(_rate)}}},{key:'throwError',value:function throwError(error){if(!enableSound){return}displayError(error+'<br> Sound id: '+this.nIdex+'<br>Sound source: '+this.sourceData+'<br>Scene: '+getCurrentSceneID()+'<br>Frame: '+getCurrentFrame())}},{key:'sanitizeInput',value:function sanitizeInput(acceptedType,input,defa,paramName,methodName){if(!enableSound){return}if(input===null||typeof input==='undefined'){input=defa}if(input===def){input=defa}if((typeof input==='undefined'?'undefined':_typeof(input))!==acceptedType){displayError('Type Exception: \''+paramName+'\' parameter in method \''+methodName+'\' must be a '+acceptedType+'! '+'<br>'+paramName+' input type: '+(typeof input==='undefined'?'undefined':_typeof(input))+'<br>'+paramName+' input value: '+input+'<br> Sound id: '+this.nIdex+'<br>Sound source: '+this.sourceData+'<br>Scene: '+getCurrentSceneID()+'<br>Frame: '+getCurrentFrame())}return input}}]);return GameSound}();